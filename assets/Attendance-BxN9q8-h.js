import{c as t,I as oe,_ as Le,r as v,a8 as r,a7 as Fe,o as Ye,a as x,b as w,k as n,g,ay as Ne,w as a,C as Ve,d as qe,an as Qe,e as C,f as Je,aj as Ke,a0 as We,j as Ge,U as Xe,V as Ze,B as et,ak as tt,a2 as at,aB as lt,S as nt,t as I,ao as ut,az as st,Q as ot,R as rt,m as dt,p as Y,q as ae,s as it,ae as le,W as N,a3 as mt,a4 as ne,a5 as ct,a6 as _t,ag as vt,ar as pt,$ as ft,ad as kt,ac as yt,aK as gt,au as Ct,K as p}from"./index-Dk-eNI3p.js";var ht={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M855.7 210.8l-42.4-42.4a8.03 8.03 0 00-11.3 0L168.3 801.9a8.03 8.03 0 000 11.3l42.4 42.4c3.1 3.1 8.2 3.1 11.3 0L855.6 222c3.2-3 3.2-8.1.1-11.2zM304 448c79.4 0 144-64.6 144-144s-64.6-144-144-144-144 64.6-144 144 64.6 144 144 144zm0-216c39.7 0 72 32.3 72 72s-32.3 72-72 72-72-32.3-72-72 32.3-72 72-72zm416 344c-79.4 0-144 64.6-144 144s64.6 144 144 144 144-64.6 144-144-64.6-144-144-144zm0 216c-39.7 0-72-32.3-72-72s32.3-72 72-72 72 32.3 72 72-32.3 72-72 72z"}}]},name:"percentage",theme:"outlined"};function ue(d){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?Object(arguments[s]):{},c=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(o).filter(function(f){return Object.getOwnPropertyDescriptor(o,f).enumerable}))),c.forEach(function(f){wt(d,f,o[f])})}return d}function wt(d,s,o){return s in d?Object.defineProperty(d,s,{value:o,enumerable:!0,configurable:!0,writable:!0}):d[s]=o,d}var V=function(s,o){var c=ue({},s,o.attrs);return t(oe,ue({},c,{icon:ht}),null)};V.displayName="PercentageOutlined";V.inheritAttrs=!1;var It={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M678.3 655.4c24.2-13 51.9-20.4 81.4-20.4h.1c3 0 4.4-3.6 2.2-5.6a371.67 371.67 0 00-103.7-65.8c-.4-.2-.8-.3-1.2-.5C719.2 518 759.6 444.7 759.6 362c0-137-110.8-248-247.5-248S264.7 225 264.7 362c0 82.7 40.4 156 102.6 201.1-.4.2-.8.3-1.2.5-44.7 18.9-84.8 46-119.3 80.6a373.42 373.42 0 00-80.4 119.5A373.6 373.6 0 00137 901.8a8 8 0 008 8.2h59.9c4.3 0 7.9-3.5 8-7.8 2-77.2 32.9-149.5 87.6-204.3C357 641.2 432.2 610 512.2 610c56.7 0 111.1 15.7 158 45.1a8.1 8.1 0 008.1.3zM512.2 534c-45.8 0-88.9-17.9-121.4-50.4A171.2 171.2 0 01340.5 362c0-45.9 17.9-89.1 50.3-121.6S466.3 190 512.2 190s88.9 17.9 121.4 50.4A171.2 171.2 0 01683.9 362c0 45.9-17.9 89.1-50.3 121.6C601.1 516.1 558 534 512.2 534zM880 772H640c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h240c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"user-delete",theme:"outlined"};function se(d){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?Object(arguments[s]):{},c=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(o).filter(function(f){return Object.getOwnPropertyDescriptor(o,f).enumerable}))),c.forEach(function(f){Tt(d,f,o[f])})}return d}function Tt(d,s,o){return s in d?Object.defineProperty(d,s,{value:o,enumerable:!0,configurable:!0,writable:!0}):d[s]=o,d}var q=function(s,o){var c=se({},s,o.attrs);return t(oe,se({},c,{icon:It}),null)};q.displayName="UserDeleteOutlined";q.inheritAttrs=!1;const bt={class:"attendance-management"},xt={class:"page-header"},Ot={class:"total-text"},$t={ref:"trendChart",class:"chart-container"},St={ref:"compareChart",class:"chart-container"},Pt=["onClick"],At=["onClick"],Et=["onClick"],Mt=["onClick"],Dt={__name:"Attendance",setup(d){const s=v(""),o=v([]),c=v(""),f=v(""),H=v(!1),Q=v("week"),J=v("rate"),k=v([]),O=v({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:(l,e)=>`第 ${e[0]}-${e[1]} 条，共 ${l} 条`}),re=[{label:"今天",value:[r(),r()]},{label:"昨天",value:[r().subtract(1,"day"),r().subtract(1,"day")]},{label:"最近7天",value:[r().subtract(7,"day"),r()]},{label:"最近30天",value:[r().subtract(30,"day"),r()]},{label:"本月",value:[r().startOf("month"),r().endOf("month")]}],A=v([{id:"EMP001",employeeId:"E001",name:"张师傅",department:"运输部"},{id:"EMP002",employeeId:"E002",name:"李调度",department:"调度部"},{id:"EMP003",employeeId:"E003",name:"王维修",department:"维修部"},{id:"EMP004",employeeId:"E004",name:"赵财务",department:"财务部"},{id:"EMP005",employeeId:"E005",name:"钱人事",department:"人事部"}]),h=v([{id:"ATT001",employeeId:"E001",name:"张师傅",department:"运输部",date:"2024-07-02",checkInTime:"08:30:00",checkOutTime:"18:00:00",workHours:8.5,status:"迟到",remark:"路上堵车",key:"ATT001"},{id:"ATT002",employeeId:"E002",name:"李调度",department:"调度部",date:"2024-07-02",checkInTime:"08:00:00",checkOutTime:"18:00:00",workHours:9,status:"正常",remark:"",key:"ATT002"},{id:"ATT003",employeeId:"E003",name:"王维修",department:"维修部",date:"2024-07-02",checkInTime:"08:00:00",checkOutTime:"17:30:00",workHours:8.5,status:"早退",remark:"家中有事",key:"ATT003"},{id:"ATT004",employeeId:"E004",name:"赵财务",department:"财务部",date:"2024-07-02",checkInTime:"08:00:00",checkOutTime:"18:00:00",workHours:9,status:"正常",remark:"",key:"ATT004"},{id:"ATT005",employeeId:"E005",name:"钱人事",department:"人事部",date:"2024-07-02",checkInTime:null,checkOutTime:null,workHours:0,status:"请假",remark:"病假",key:"ATT005"}]),$=v({totalStaff:A.value.length,todayPresent:h.value.filter(l=>l.status!=="缺勤"&&l.status!=="请假").length,lateCount:h.value.filter(l=>l.status==="迟到").length,leaveCount:h.value.filter(l=>l.status==="请假").length,attendanceRate:Math.round(h.value.filter(l=>l.status!=="缺勤"&&l.status!=="请假").length/A.value.length*100)}),de=[{title:"姓名",dataIndex:"name",key:"name",width:100},{title:"工号",dataIndex:"employeeId",key:"employeeId",width:100},{title:"部门",dataIndex:"department",key:"department",width:100},{title:"日期",dataIndex:"date",key:"date",width:120},{title:"上班时间",dataIndex:"checkInTime",key:"checkInTime",width:120},{title:"下班时间",dataIndex:"checkOutTime",key:"checkOutTime",width:120},{title:"工作时长",dataIndex:"workHours",key:"workHours",width:100},{title:"考勤状态",dataIndex:"status",key:"status",width:100},{title:"备注",dataIndex:"remark",key:"remark",width:150},{title:"操作",key:"actions",width:200,fixed:"right"}],ie=Fe(()=>{let l=h.value;if(s.value){const e=s.value.toLowerCase();l=l.filter(T=>T.name.toLowerCase().includes(e)||T.employeeId.toLowerCase().includes(e))}if(c.value&&(l=l.filter(e=>e.department===c.value)),f.value&&(l=l.filter(e=>e.status===f.value)),o.value&&o.value.length===2){const[e,T]=o.value;l=l.filter(y=>{const D=r(y.date);return D.isAfter(r(e).subtract(1,"day"))&&D.isBefore(r(T).add(1,"day"))})}return O.value.total=l.length,l}),E=v(!1),K=v(),i=v({employeeId:"",type:"in",time:null,remark:""}),me={employeeId:[{required:!0,message:"请选择员工",trigger:"change"}],type:[{required:!0,message:"请选择打卡类型",trigger:"change"}],time:[{required:!0,message:"请选择打卡时间",trigger:"change"}]},ce=l=>({正常:"green",迟到:"orange",早退:"blue",缺勤:"red",请假:"purple"})[l]||"default",_e=l=>l?r(`2024-01-01 ${l}`).isAfter(r("2024-01-01 08:00:00")):!1,ve=l=>l?r(`2024-01-01 ${l}`).isBefore(r("2024-01-01 18:00:00")):!1,W=l=>l||"-",pe=l=>l?r(l).format("YYYY-MM-DD"):"-",fe=l=>{s.value=l,O.value.current=1},j=()=>{O.value.current=1},ke=()=>{H.value=!0,setTimeout(()=>{H.value=!1,p.success("数据已刷新")},1e3)},ye=()=>{p.success("考勤数据导出成功")},ge=()=>{E.value=!0},Ce=l=>{k.value=l},he=l=>{O.value={...O.value,...l}},we=l=>{p.info(`查看员工详情: ${l.name}`)},Ie=l=>{p.info(`编辑考勤记录: ${l.id}`)},Te=l=>{p.info(`查看考勤详情: ${l.id}`)},be=l=>{l.status="正常",p.success(`考勤记录 ${l.id} 已修正`)},xe=l=>{p.success(`考勤记录 ${l.id} 审批通过`)},Oe=l=>{p.info(`为考勤记录 ${l.id} 添加备注`)},$e=l=>{p.success(`考勤记录 ${l.id} 导出成功`)},Se=()=>{p.success(`批量审批 ${k.value.length} 条记录`),k.value=[]},Pe=()=>{p.success(`批量导出 ${k.value.length} 条记录`),k.value=[]},Ae=()=>{k.value.forEach(l=>{const e=h.value.find(T=>T.key===l);e&&(e.status="正常")}),p.success(`批量修正 ${k.value.length} 条记录`),k.value=[]},Ee=()=>{p.success(`生成 ${k.value.length} 条记录的考勤报告`),k.value=[]},Me=()=>{K.value.validate().then(()=>{const l={id:`ATT${String(h.value.length+1).padStart(3,"0")}`,employeeId:i.value.employeeId,name:A.value.find(e=>e.id===i.value.employeeId)?.name,department:A.value.find(e=>e.id===i.value.employeeId)?.department,date:r().format("YYYY-MM-DD"),checkInTime:i.value.type==="in"?i.value.time.format("HH:mm:ss"):null,checkOutTime:i.value.type==="out"?i.value.time.format("HH:mm:ss"):null,workHours:0,status:"正常",remark:i.value.remark,key:`ATT${String(h.value.length+1).padStart(3,"0")}`};h.value.unshift(l),p.success("手动打卡成功"),E.value=!1,G()}).catch(()=>{p.error("请检查表单信息")})},De=()=>{E.value=!1,G()},G=()=>{i.value={employeeId:"",type:"in",time:null,remark:""}};return Ye(()=>{}),(l,e)=>{const T=Ke,y=Je,D=We,_=Ze,R=Xe,z=Ge,M=et,L=qe,b=Ve,U=nt,F=rt,X=ot,S=_t,Z=ct,ee=mt,Re=it,ze=dt,B=ft,te=yt,Ue=gt,Be=Ct,He=pt,je=Qe;return C(),x("div",bt,[w("div",xt,[w("h1",null,[t(g(Ne)),e[11]||(e[11]=n(" 考勤管理 "))]),e[12]||(e[12]=w("p",null,"管理员工考勤记录，统计出勤情况，提升工作效率",-1))]),t(b,{class:"toolbar-card"},{default:a(()=>[t(L,{gutter:[16,16],align:"middle"},{default:a(()=>[t(y,{xs:24,sm:12,md:6},{default:a(()=>[t(T,{value:s.value,"onUpdate:value":e[0]||(e[0]=u=>s.value=u),placeholder:"搜索员工姓名、工号",onSearch:fe,style:{width:"100%"}},null,8,["value"])]),_:1}),t(y,{xs:24,sm:12,md:6},{default:a(()=>[t(D,{value:o.value,"onUpdate:value":e[1]||(e[1]=u=>o.value=u),style:{width:"100%"},onChange:j,presets:re},null,8,["value"])]),_:1}),t(y,{xs:24,sm:12,md:6},{default:a(()=>[t(z,null,{default:a(()=>[t(R,{value:c.value,"onUpdate:value":e[2]||(e[2]=u=>c.value=u),placeholder:"部门",style:{width:"120px"},onChange:j},{default:a(()=>[t(_,{value:""},{default:a(()=>e[13]||(e[13]=[n("全部部门")])),_:1,__:[13]}),t(_,{value:"调度部"},{default:a(()=>e[14]||(e[14]=[n("调度部")])),_:1,__:[14]}),t(_,{value:"运输部"},{default:a(()=>e[15]||(e[15]=[n("运输部")])),_:1,__:[15]}),t(_,{value:"维修部"},{default:a(()=>e[16]||(e[16]=[n("维修部")])),_:1,__:[16]}),t(_,{value:"财务部"},{default:a(()=>e[17]||(e[17]=[n("财务部")])),_:1,__:[17]})]),_:1},8,["value"]),t(R,{value:f.value,"onUpdate:value":e[3]||(e[3]=u=>f.value=u),placeholder:"考勤状态",style:{width:"120px"},onChange:j},{default:a(()=>[t(_,{value:""},{default:a(()=>e[18]||(e[18]=[n("全部状态")])),_:1,__:[18]}),t(_,{value:"正常"},{default:a(()=>e[19]||(e[19]=[n("正常")])),_:1,__:[19]}),t(_,{value:"迟到"},{default:a(()=>e[20]||(e[20]=[n("迟到")])),_:1,__:[20]}),t(_,{value:"早退"},{default:a(()=>e[21]||(e[21]=[n("早退")])),_:1,__:[21]}),t(_,{value:"缺勤"},{default:a(()=>e[22]||(e[22]=[n("缺勤")])),_:1,__:[22]}),t(_,{value:"请假"},{default:a(()=>e[23]||(e[23]=[n("请假")])),_:1,__:[23]})]),_:1},8,["value"])]),_:1})]),_:1}),t(y,{xs:24,sm:24,md:6,class:"text-right"},{default:a(()=>[t(z,null,{default:a(()=>[t(M,{onClick:ke},{default:a(()=>[t(g(tt)),e[24]||(e[24]=n(" 刷新 "))]),_:1,__:[24]}),t(M,{onClick:ye},{default:a(()=>[t(g(at)),e[25]||(e[25]=n(" 导出 "))]),_:1,__:[25]}),t(M,{type:"primary",onClick:ge},{default:a(()=>[t(g(lt)),e[26]||(e[26]=n(" 手动打卡 "))]),_:1,__:[26]})]),_:1})]),_:1})]),_:1})]),_:1}),t(L,{gutter:[16,16],class:"stats-cards"},{default:a(()=>[t(y,{xs:24,sm:12,md:6},{default:a(()=>[t(b,{class:"stat-card"},{default:a(()=>[t(U,{title:"今日出勤",value:$.value.todayPresent,total:$.value.totalStaff,"value-style":{color:"#52c41a"}},{prefix:a(()=>[t(g(ut))]),suffix:a(()=>[w("span",Ot,"/ "+I($.value.totalStaff),1)]),_:1},8,["value","total"])]),_:1})]),_:1}),t(y,{xs:24,sm:12,md:6},{default:a(()=>[t(b,{class:"stat-card"},{default:a(()=>[t(U,{title:"迟到人数",value:$.value.lateCount,"value-style":{color:"#fa8c16"}},{prefix:a(()=>[t(g(st))]),_:1},8,["value"])]),_:1})]),_:1}),t(y,{xs:24,sm:12,md:6},{default:a(()=>[t(b,{class:"stat-card"},{default:a(()=>[t(U,{title:"请假人数",value:$.value.leaveCount,"value-style":{color:"#1890ff"}},{prefix:a(()=>[t(g(q))]),_:1},8,["value"])]),_:1})]),_:1}),t(y,{xs:24,sm:12,md:6},{default:a(()=>[t(b,{class:"stat-card"},{default:a(()=>[t(U,{title:"出勤率",value:$.value.attendanceRate,suffix:"%","value-style":{color:"#722ed1"}},{prefix:a(()=>[t(g(V))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),t(L,{gutter:[16,16],class:"charts-section"},{default:a(()=>[t(y,{xs:24,lg:12},{default:a(()=>[t(b,{title:"考勤趋势分析",class:"chart-card"},{extra:a(()=>[t(X,{value:Q.value,"onUpdate:value":e[4]||(e[4]=u=>Q.value=u),size:"small"},{default:a(()=>[t(F,{value:"week"},{default:a(()=>e[27]||(e[27]=[n("周")])),_:1,__:[27]}),t(F,{value:"month"},{default:a(()=>e[28]||(e[28]=[n("月")])),_:1,__:[28]}),t(F,{value:"quarter"},{default:a(()=>e[29]||(e[29]=[n("季")])),_:1,__:[29]})]),_:1},8,["value"])]),default:a(()=>[w("div",$t,null,512)]),_:1})]),_:1}),t(y,{xs:24,lg:12},{default:a(()=>[t(b,{title:"部门出勤对比",class:"chart-card"},{extra:a(()=>[t(R,{value:J.value,"onUpdate:value":e[5]||(e[5]=u=>J.value=u),size:"small",style:{width:"100px"}},{default:a(()=>[t(_,{value:"rate"},{default:a(()=>e[30]||(e[30]=[n("出勤率")])),_:1,__:[30]}),t(_,{value:"late"},{default:a(()=>e[31]||(e[31]=[n("迟到率")])),_:1,__:[31]}),t(_,{value:"leave"},{default:a(()=>e[32]||(e[32]=[n("请假率")])),_:1,__:[32]})]),_:1},8,["value"])]),default:a(()=>[w("div",St,null,512)]),_:1})]),_:1})]),_:1}),t(b,{title:"考勤记录",class:"attendance-table-card"},{extra:a(()=>[t(z,null,{default:a(()=>[t(M,{size:"small",onClick:Se,disabled:k.value.length===0},{default:a(()=>[t(g(vt)),e[33]||(e[33]=n(" 批量审批 "))]),_:1,__:[33]},8,["disabled"]),t(ee,null,{overlay:a(()=>[t(Z,null,{default:a(()=>[t(S,{key:"1",onClick:Pe},{default:a(()=>e[35]||(e[35]=[n("批量导出")])),_:1,__:[35]}),t(S,{key:"2",onClick:Ae},{default:a(()=>e[36]||(e[36]=[n("批量修正")])),_:1,__:[36]}),t(S,{key:"3",onClick:Ee},{default:a(()=>e[37]||(e[37]=[n("生成报告")])),_:1,__:[37]})]),_:1})]),default:a(()=>[t(M,{size:"small"},{default:a(()=>[e[34]||(e[34]=n(" 更多操作 ")),t(g(ne))]),_:1,__:[34]})]),_:1})]),_:1})]),default:a(()=>[t(ze,{columns:de,"data-source":ie.value,pagination:O.value,loading:H.value,"row-selection":{selectedRowKeys:k.value,onChange:Ce},onChange:he,size:"small",bordered:""},{bodyCell:a(({column:u,record:m})=>[u.key==="name"?(C(),x("a",{key:0,onClick:P=>we(m)},I(m.name),9,Pt)):u.key==="status"?(C(),Y(Re,{key:1,color:ce(m.status)},{default:a(()=>[n(I(m.status),1)]),_:2},1032,["color"])):u.key==="checkInTime"?(C(),x("span",{key:2,class:le({"text-danger":_e(m.checkInTime)})},I(W(m.checkInTime)),3)):u.key==="checkOutTime"?(C(),x("span",{key:3,class:le({"text-warning":ve(m.checkOutTime)})},I(W(m.checkOutTime)),3)):u.key==="workHours"?(C(),x(N,{key:4},[n(I(m.workHours)+"小时 ",1)],64)):u.key==="date"?(C(),x(N,{key:5},[n(I(pe(m.date)),1)],64)):u.key==="actions"?(C(),Y(z,{key:6},{default:a(()=>[w("a",{onClick:P=>Ie(m)},"编辑",8,At),w("a",{onClick:P=>Te(m)},"详情",8,Et),m.status!=="正常"?(C(),x("a",{key:0,onClick:P=>be(m)},"修正",8,Mt)):ae("",!0),t(ee,null,{overlay:a(()=>[t(Z,null,{default:a(()=>[t(S,{key:"1",onClick:P=>xe(m)},{default:a(()=>e[39]||(e[39]=[n("审批")])),_:2,__:[39]},1032,["onClick"]),t(S,{key:"2",onClick:P=>Oe(m)},{default:a(()=>e[40]||(e[40]=[n("添加备注")])),_:2,__:[40]},1032,["onClick"]),t(S,{key:"3",onClick:P=>$e(m)},{default:a(()=>e[41]||(e[41]=[n("导出记录")])),_:2,__:[41]},1032,["onClick"])]),_:2},1024)]),default:a(()=>[w("a",null,[e[38]||(e[38]=n(" 更多 ")),t(g(ne))])]),_:2},1024)]),_:2},1024)):ae("",!0)]),_:1},8,["data-source","pagination","loading","row-selection"])]),_:1}),t(je,{open:E.value,"onUpdate:open":e[10]||(e[10]=u=>E.value=u),title:"手动打卡",width:"500px",onOk:Me,onCancel:De},{default:a(()=>[t(He,{ref_key:"checkInFormRef",ref:K,model:i.value,rules:me,layout:"vertical"},{default:a(()=>[t(B,{label:"员工",name:"employeeId"},{default:a(()=>[t(R,{value:i.value.employeeId,"onUpdate:value":e[6]||(e[6]=u=>i.value.employeeId=u),placeholder:"请选择员工"},{default:a(()=>[(C(!0),x(N,null,kt(A.value,u=>(C(),Y(_,{key:u.id,value:u.id},{default:a(()=>[n(I(u.name)+" ("+I(u.employeeId)+") ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(B,{label:"打卡类型",name:"type"},{default:a(()=>[t(X,{value:i.value.type,"onUpdate:value":e[7]||(e[7]=u=>i.value.type=u)},{default:a(()=>[t(te,{value:"in"},{default:a(()=>e[42]||(e[42]=[n("上班打卡")])),_:1,__:[42]}),t(te,{value:"out"},{default:a(()=>e[43]||(e[43]=[n("下班打卡")])),_:1,__:[43]})]),_:1},8,["value"])]),_:1}),t(B,{label:"打卡时间",name:"time"},{default:a(()=>[t(Ue,{value:i.value.time,"onUpdate:value":e[8]||(e[8]=u=>i.value.time=u),style:{width:"100%"}},null,8,["value"])]),_:1}),t(B,{label:"备注",name:"remark"},{default:a(()=>[t(Be,{value:i.value.remark,"onUpdate:value":e[9]||(e[9]=u=>i.value.remark=u),placeholder:"请输入备注信息",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])])}}},zt=Le(Dt,[["__scopeId","data-v-b5e02129"]]);export{zt as default};
