import{_ as he,r as p,a8 as i,a7 as Ce,o as xe,a as D,b as m,c as t,k as s,g as c,aH as be,w as a,C as Te,d as we,e as y,f as De,aj as Se,a0 as Ne,j as $e,U as Ie,V as Oe,B as Re,ak as Be,a2 as Me,a9 as Pe,S as ze,ao as He,aB as Ue,az as Ae,Q as Ve,R as Ee,m as Ke,p as U,q as Ye,t as x,s as je,ae as Fe,W as F,a3 as Le,a4 as L,a5 as Qe,a6 as qe,ap as Je,l as We,K as u}from"./index-BK7oz1s9.js";import{S as Ge}from"./SendOutlined-Bp1TPLmn.js";const Xe={class:"dispatch-history"},Ze={class:"page-header"},et={ref:"trendChart",class:"chart-container"},tt={ref:"performanceChart",class:"chart-container"},at=["onClick"],lt=["onClick"],st=["onClick"],nt=["onClick"],ot={__name:"History",setup(it){const b=p(""),T=p([]),S=p(""),N=p(""),B=p(!1),A=p("week"),V=p("count"),r=p([]),h=p({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:(l,e)=>`第 ${e[0]}-${e[1]} 条，共 ${l} 条`}),Q=[{label:"今天",value:[i(),i()]},{label:"昨天",value:[i().subtract(1,"day"),i().subtract(1,"day")]},{label:"最近7天",value:[i().subtract(7,"day"),i()]},{label:"最近30天",value:[i().subtract(30,"day"),i()]},{label:"本月",value:[i().startOf("month"),i().endOf("month")]},{label:"上月",value:[i().subtract(1,"month").startOf("month"),i().subtract(1,"month").endOf("month")]}],v=p([{id:"DISP001",orderNumber:"ORD001",vehicleNumber:"京A12345",driver:"张师傅",dispatcher:"张调度",status:"completed",priority:"普通",origin:"北京市朝阳区",destination:"天津市",dispatchTime:"2024-06-28 09:00:00",completedTime:"2024-06-28 15:30:00",responseTime:5,key:"DISP001"},{id:"DISP002",orderNumber:"ORD002",vehicleNumber:"沪C11111",driver:"李师傅",dispatcher:"李调度",status:"completed",priority:"紧急",origin:"上海市浦东新区",destination:"杭州市",dispatchTime:"2024-06-27 14:00:00",completedTime:"2024-06-27 18:45:00",responseTime:3,key:"DISP002"},{id:"DISP003",orderNumber:"ORD003",vehicleNumber:"粤B88888",driver:"王师傅",dispatcher:"王调度",status:"delayed",priority:"高",origin:"深圳市南山区",destination:"广州市",dispatchTime:"2024-06-26 10:30:00",completedTime:"2024-06-26 20:15:00",responseTime:45,key:"DISP003"},{id:"DISP004",orderNumber:"ORD004",vehicleNumber:"川A66666",driver:"赵师傅",dispatcher:"张调度",status:"completed",priority:"普通",origin:"成都市锦江区",destination:"重庆市",dispatchTime:"2024-06-25 08:15:00",completedTime:"2024-06-25 14:30:00",responseTime:8,key:"DISP004"},{id:"DISP005",orderNumber:"ORD005",vehicleNumber:"鲁D33333",driver:"钱师傅",dispatcher:"李调度",status:"cancelled",priority:"低",origin:"济南市历下区",destination:"青岛市",dispatchTime:"2024-06-24 16:00:00",completedTime:null,responseTime:15,key:"DISP005"}]),$=p({totalDispatches:v.value.length,successRate:Math.round(v.value.filter(l=>l.status==="completed").length/v.value.length*100),avgResponseTime:Math.round(v.value.reduce((l,e)=>l+e.responseTime,0)/v.value.length),delayRate:Math.round(v.value.filter(l=>l.status==="delayed").length/v.value.length*100)}),q=[{title:"订单号",dataIndex:"orderNumber",key:"orderNumber",width:120},{title:"车牌号",dataIndex:"vehicleNumber",key:"vehicleNumber",width:120},{title:"司机",dataIndex:"driver",key:"driver",width:100},{title:"调度员",dataIndex:"dispatcher",key:"dispatcher",width:100},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"优先级",dataIndex:"priority",key:"priority",width:80},{title:"起点",dataIndex:"origin",key:"origin",width:150},{title:"终点",dataIndex:"destination",key:"destination",width:150},{title:"响应时间",dataIndex:"responseTime",key:"responseTime",width:100},{title:"调度时间",dataIndex:"dispatchTime",key:"dispatchTime",width:150},{title:"完成时间",dataIndex:"completedTime",key:"completedTime",width:150},{title:"操作",key:"actions",width:200,fixed:"right"}],J=Ce(()=>{let l=v.value;if(b.value){const e=b.value.toLowerCase();l=l.filter(C=>C.orderNumber.toLowerCase().includes(e)||C.vehicleNumber.toLowerCase().includes(e))}if(S.value&&(l=l.filter(e=>e.status===S.value)),N.value&&(l=l.filter(e=>e.dispatcher===N.value)),T.value&&T.value.length===2){const[e,C]=T.value;l=l.filter(d=>{const I=i(d.dispatchTime);return I.isAfter(i(e).subtract(1,"day"))&&I.isBefore(i(C).add(1,"day"))})}return h.value.total=l.length,l}),W=l=>({completed:"green",cancelled:"red",delayed:"orange"})[l]||"default",G=l=>({completed:"已完成",cancelled:"已取消",delayed:"延误"})[l]||l,X=l=>({紧急:"red",高:"orange",普通:"blue",低:"default"})[l]||"default",E=l=>l?i(l).format("YYYY-MM-DD HH:mm"):"-",Z=l=>{b.value=l,h.value.current=1},M=()=>{h.value.current=1},ee=()=>{B.value=!0,setTimeout(()=>{B.value=!1,u.success("数据已刷新")},1e3)},te=()=>{u.success("调度历史数据导出成功")},ae=()=>{u.success("调度分析报告生成成功")},le=l=>{r.value=l},se=l=>{h.value={...h.value,...l}},ne=l=>{u.info(`查看订单详情: ${l.orderNumber}`)},oe=l=>{u.info(`查看调度详情: ${l.id}`)},ie=l=>{u.info(`查看调度时间线: ${l.id}`)},ue=l=>{u.info(`分析调度记录: ${l.id}`)},de=l=>{u.success(`调度记录 ${l.id} 已复制`)},re=l=>{u.success(`调度记录 ${l.id} 导出成功`)},_e=l=>{u.info(`为调度记录 ${l.id} 添加备注`)},pe=l=>{u.success(`调度记录 ${l.id} 已归档`)},ce=()=>{u.info(`批量分析 ${r.value.length} 条记录`),r.value=[]},me=()=>{u.success(`批量导出 ${r.value.length} 条记录`),r.value=[]},ve=()=>{u.success(`批量生成 ${r.value.length} 个调度报告`),r.value=[]},fe=()=>{u.success(`批量归档 ${r.value.length} 条记录`),r.value=[]};return xe(()=>{}),(l,e)=>{const C=Se,d=De,I=Ne,_=Oe,P=Ie,O=$e,w=Re,z=we,f=Te,R=ze,H=Ee,ye=Ve,k=qe,K=Qe,Y=Le,j=je,ke=Je,ge=Ke;return y(),D("div",Xe,[m("div",Ze,[m("h1",null,[t(c(be)),e[6]||(e[6]=s(" 调度历史 "))]),e[7]||(e[7]=m("p",null,"查看历史调度记录，分析调度效率，优化调度策略",-1))]),t(f,{class:"toolbar-card"},{default:a(()=>[t(z,{gutter:[16,16],align:"middle"},{default:a(()=>[t(d,{xs:24,sm:12,md:6},{default:a(()=>[t(C,{value:b.value,"onUpdate:value":e[0]||(e[0]=o=>b.value=o),placeholder:"搜索订单号、车牌号",onSearch:Z,style:{width:"100%"}},null,8,["value"])]),_:1}),t(d,{xs:24,sm:12,md:6},{default:a(()=>[t(I,{value:T.value,"onUpdate:value":e[1]||(e[1]=o=>T.value=o),style:{width:"100%"},onChange:M,presets:Q},null,8,["value"])]),_:1}),t(d,{xs:24,sm:12,md:6},{default:a(()=>[t(O,null,{default:a(()=>[t(P,{value:S.value,"onUpdate:value":e[2]||(e[2]=o=>S.value=o),placeholder:"调度状态",style:{width:"120px"},onChange:M},{default:a(()=>[t(_,{value:""},{default:a(()=>e[8]||(e[8]=[s("全部状态")])),_:1,__:[8]}),t(_,{value:"completed"},{default:a(()=>e[9]||(e[9]=[s("已完成")])),_:1,__:[9]}),t(_,{value:"cancelled"},{default:a(()=>e[10]||(e[10]=[s("已取消")])),_:1,__:[10]}),t(_,{value:"delayed"},{default:a(()=>e[11]||(e[11]=[s("延误")])),_:1,__:[11]})]),_:1},8,["value"]),t(P,{value:N.value,"onUpdate:value":e[3]||(e[3]=o=>N.value=o),placeholder:"调度员",style:{width:"120px"},onChange:M},{default:a(()=>[t(_,{value:""},{default:a(()=>e[12]||(e[12]=[s("全部调度员")])),_:1,__:[12]}),t(_,{value:"张调度"},{default:a(()=>e[13]||(e[13]=[s("张调度")])),_:1,__:[13]}),t(_,{value:"李调度"},{default:a(()=>e[14]||(e[14]=[s("李调度")])),_:1,__:[14]}),t(_,{value:"王调度"},{default:a(()=>e[15]||(e[15]=[s("王调度")])),_:1,__:[15]})]),_:1},8,["value"])]),_:1})]),_:1}),t(d,{xs:24,sm:24,md:6,class:"text-right"},{default:a(()=>[t(O,null,{default:a(()=>[t(w,{onClick:ee},{default:a(()=>[t(c(Be)),e[16]||(e[16]=s(" 刷新 "))]),_:1,__:[16]}),t(w,{onClick:te},{default:a(()=>[t(c(Me)),e[17]||(e[17]=s(" 导出 "))]),_:1,__:[17]}),t(w,{onClick:ae},{default:a(()=>[t(c(Pe)),e[18]||(e[18]=s(" 生成报告 "))]),_:1,__:[18]})]),_:1})]),_:1})]),_:1})]),_:1}),t(z,{gutter:[16,16],class:"stats-cards"},{default:a(()=>[t(d,{xs:24,sm:12,md:6},{default:a(()=>[t(f,{class:"stat-card"},{default:a(()=>[t(R,{title:"总调度次数",value:$.value.totalDispatches,"value-style":{color:"#1890ff"}},{prefix:a(()=>[t(c(Ge))]),_:1},8,["value"])]),_:1})]),_:1}),t(d,{xs:24,sm:12,md:6},{default:a(()=>[t(f,{class:"stat-card"},{default:a(()=>[t(R,{title:"成功率",value:$.value.successRate,suffix:"%","value-style":{color:"#52c41a"}},{prefix:a(()=>[t(c(He))]),_:1},8,["value"])]),_:1})]),_:1}),t(d,{xs:24,sm:12,md:6},{default:a(()=>[t(f,{class:"stat-card"},{default:a(()=>[t(R,{title:"平均响应时间",value:$.value.avgResponseTime,suffix:"分钟","value-style":{color:"#722ed1"}},{prefix:a(()=>[t(c(Ue))]),_:1},8,["value"])]),_:1})]),_:1}),t(d,{xs:24,sm:12,md:6},{default:a(()=>[t(f,{class:"stat-card"},{default:a(()=>[t(R,{title:"延误率",value:$.value.delayRate,suffix:"%","value-style":{color:"#fa8c16"}},{prefix:a(()=>[t(c(Ae))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),t(z,{gutter:[16,16],class:"charts-section"},{default:a(()=>[t(d,{xs:24,lg:12},{default:a(()=>[t(f,{title:"调度趋势分析",class:"chart-card"},{extra:a(()=>[t(ye,{value:A.value,"onUpdate:value":e[4]||(e[4]=o=>A.value=o),size:"small"},{default:a(()=>[t(H,{value:"day"},{default:a(()=>e[19]||(e[19]=[s("日")])),_:1,__:[19]}),t(H,{value:"week"},{default:a(()=>e[20]||(e[20]=[s("周")])),_:1,__:[20]}),t(H,{value:"month"},{default:a(()=>e[21]||(e[21]=[s("月")])),_:1,__:[21]})]),_:1},8,["value"])]),default:a(()=>[m("div",et,null,512)]),_:1})]),_:1}),t(d,{xs:24,lg:12},{default:a(()=>[t(f,{title:"调度员绩效对比",class:"chart-card"},{extra:a(()=>[t(P,{value:V.value,"onUpdate:value":e[5]||(e[5]=o=>V.value=o),size:"small",style:{width:"100px"}},{default:a(()=>[t(_,{value:"count"},{default:a(()=>e[22]||(e[22]=[s("调度次数")])),_:1,__:[22]}),t(_,{value:"success"},{default:a(()=>e[23]||(e[23]=[s("成功率")])),_:1,__:[23]}),t(_,{value:"response"},{default:a(()=>e[24]||(e[24]=[s("响应时间")])),_:1,__:[24]})]),_:1},8,["value"])]),default:a(()=>[m("div",tt,null,512)]),_:1})]),_:1})]),_:1}),t(f,{title:"调度记录",class:"history-table-card"},{extra:a(()=>[t(O,null,{default:a(()=>[t(w,{size:"small",onClick:ce,disabled:r.value.length===0},{default:a(()=>[t(c(We)),e[25]||(e[25]=s(" 批量分析 "))]),_:1,__:[25]},8,["disabled"]),t(Y,null,{overlay:a(()=>[t(K,null,{default:a(()=>[t(k,{key:"1",onClick:me},{default:a(()=>e[27]||(e[27]=[s("批量导出")])),_:1,__:[27]}),t(k,{key:"2",onClick:ve},{default:a(()=>e[28]||(e[28]=[s("生成报告")])),_:1,__:[28]}),t(k,{key:"3",onClick:fe},{default:a(()=>e[29]||(e[29]=[s("批量归档")])),_:1,__:[29]})]),_:1})]),default:a(()=>[t(w,{size:"small"},{default:a(()=>[e[26]||(e[26]=s(" 更多操作 ")),t(c(L))]),_:1,__:[26]})]),_:1})]),_:1})]),default:a(()=>[t(ge,{columns:q,"data-source":J.value,pagination:h.value,loading:B.value,"row-selection":{selectedRowKeys:r.value,onChange:le},onChange:se,size:"small",bordered:""},{bodyCell:a(({column:o,record:n})=>[o.key==="orderNumber"?(y(),D("a",{key:0,onClick:g=>ne(n)},x(n.orderNumber),9,at)):o.key==="status"?(y(),U(j,{key:1,color:W(n.status)},{default:a(()=>[s(x(G(n.status)),1)]),_:2},1032,["color"])):o.key==="priority"?(y(),U(j,{key:2,color:X(n.priority)},{default:a(()=>[s(x(n.priority),1)]),_:2},1032,["color"])):o.key==="responseTime"?(y(),D("span",{key:3,class:Fe({"text-success":n.responseTime<=10,"text-warning":n.responseTime>10&&n.responseTime<=30,"text-danger":n.responseTime>30})},x(n.responseTime)+"分钟 ",3)):o.key==="dispatchTime"?(y(),D(F,{key:4},[s(x(E(n.dispatchTime)),1)],64)):o.key==="completedTime"?(y(),D(F,{key:5},[s(x(E(n.completedTime)),1)],64)):o.key==="actions"?(y(),U(O,{key:6},{default:a(()=>[m("a",{onClick:g=>oe(n)},"详情",8,lt),m("a",{onClick:g=>ie(n)},"时间线",8,st),m("a",{onClick:g=>ue(n)},"分析",8,nt),t(Y,null,{overlay:a(()=>[t(K,null,{default:a(()=>[t(k,{key:"1",onClick:g=>de(n)},{default:a(()=>e[31]||(e[31]=[s("复制调度")])),_:2,__:[31]},1032,["onClick"]),t(k,{key:"2",onClick:g=>re(n)},{default:a(()=>e[32]||(e[32]=[s("导出记录")])),_:2,__:[32]},1032,["onClick"]),t(k,{key:"3",onClick:g=>_e(n)},{default:a(()=>e[33]||(e[33]=[s("添加备注")])),_:2,__:[33]},1032,["onClick"]),t(ke),t(k,{key:"4",onClick:g=>pe(n)},{default:a(()=>e[34]||(e[34]=[s("归档记录")])),_:2,__:[34]},1032,["onClick"])]),_:2},1024)]),default:a(()=>[m("a",null,[e[30]||(e[30]=s(" 更多 ")),t(c(L))])]),_:2},1024)]),_:2},1024)):Ye("",!0)]),_:1},8,["data-source","pagination","loading","row-selection"])]),_:1})])}}},rt=he(ot,[["__scopeId","data-v-af9f016a"]]);export{rt as default};
